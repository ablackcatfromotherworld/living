# Livescore Scrapy é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªåŸºäºScrapyæ¡†æ¶çš„é«˜æ€§èƒ½ä½“è‚²æ¯”èµ›æ•°æ®å¤„ç†ç³»ç»Ÿï¼Œç”¨äºå¤„ç†å’Œå­˜å‚¨livescoreæ•°æ®åˆ°MySQLæ•°æ®åº“ã€‚

## é¡¹ç›®ç‰¹ç‚¹

- ğŸš€ **é«˜æ€§èƒ½**: åŸºäºScrapyå¼‚æ­¥æ¡†æ¶ï¼Œæ”¯æŒå¹¶å‘å¤„ç†
- ğŸ”„ **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡æ’å…¥æ•°æ®ï¼Œæé«˜æ•°æ®åº“æ“ä½œæ•ˆç‡
- ğŸ›¡ï¸ **æ•°æ®éªŒè¯**: å†…ç½®æ•°æ®éªŒè¯å’Œæ¸…æ´—ç®¡é“
- ğŸ“Š **ç»Ÿè®¡åˆ†æ**: æä¾›è¯¦ç»†çš„æ•°æ®ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½
- ğŸ”§ **çµæ´»é…ç½®**: æ”¯æŒå¤šç§è¿è¡Œæ¨¡å¼å’Œé…ç½®é€‰é¡¹
- ğŸ“ **å®Œæ•´æ—¥å¿—**: è¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†

## é¡¹ç›®ç»“æ„

```
livescore_scrapy/
â”œâ”€â”€ scrapy.cfg              # Scrapyé…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt        # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ run_spider.py          # è¿è¡Œè„šæœ¬
â”œâ”€â”€ items/
â”‚   â””â”€â”€ __init__.py        # æ•°æ®é¡¹å®šä¹‰
â”œâ”€â”€ pipelines/
â”‚   â””â”€â”€ __init__.py        # æ•°æ®ç®¡é“
â”œâ”€â”€ settings/
â”‚   â””â”€â”€ __init__.py        # é¡¹ç›®è®¾ç½®
â””â”€â”€ spiders/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ livescore_spider.py # çˆ¬è™«å®ç°
```

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

å¤„ç†é»˜è®¤çš„JSONæ–‡ä»¶ (`scheduler_organized.json`):

```bash
python run_spider.py
```

### 2. æŒ‡å®šJSONæ–‡ä»¶

```bash
python run_spider.py --json-file /path/to/your/data.json
```

### 3. å¤„ç†ç›®å½•ä¸­çš„æ‰€æœ‰JSONæ–‡ä»¶

```bash
python run_spider.py --spider livescore_files --data-dir /path/to/data/directory
```

### 4. æ¸…ç©ºæ•°æ®åº“è¡¨åå†æ’å…¥

```bash
python run_spider.py --clear-table
```

### 5. è®¾ç½®æ‰¹å¤„ç†å¤§å°

```bash
python run_spider.py --batch-size 200
```

### 6. æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯

```bash
python run_spider.py --show-stats
```

### 7. æŸ¥çœ‹æ¯”èµ›çŠ¶æ€è¯´æ˜

```bash
python run_spider.py --explain-status
```

## é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®

åœ¨ `settings/__init__.py` ä¸­ä¿®æ”¹æ•°æ®åº“è¿æ¥:

```python
DATABASE_URL = 'mysql+pymysql://username:password@host:port/database'
```

### æ€§èƒ½é…ç½®

```python
# å¹¶å‘è¯·æ±‚æ•°
CONCURRENT_REQUESTS = 32

# æ‰¹å¤„ç†å¤§å°
BATCH_SIZE = 100

# ä¸‹è½½å»¶è¿Ÿ
DOWNLOAD_DELAY = 0.5
```

## æ•°æ®ç»“æ„

### LivescoreItem å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | å¿…å¡« |
|------|------|------|------|
| sport | String | è¿åŠ¨ç±»å‹ (football, basketballç­‰) | âœ“ |
| date | String | æ¯”èµ›æ—¥æœŸ | âœ“ |
| time_full | String | å®Œæ•´æ—¶é—´ä¿¡æ¯ | |
| timestamp | String | æ—¶é—´æˆ³ | |
| language | String | è¯­è¨€ä»£ç  | âœ“ |
| league | String | è”èµ›åç§° | |
| country | String | å›½å®¶ | |
| team1 | String | ä¸»é˜Ÿåç§° | âœ“ |
| team2 | String | å®¢é˜Ÿåç§° | âœ“ |
| team1_img | String | ä¸»é˜Ÿå›¾æ ‡URL | |
| team2_img | String | å®¢é˜Ÿå›¾æ ‡URL | |
| score1 | String | ä¸»é˜Ÿæ¯”åˆ† | |
| score2 | String | å®¢é˜Ÿæ¯”åˆ† | |
| status | String | æ¯”èµ›çŠ¶æ€ | |

### æ•°æ®åº“è¡¨ç»“æ„

è¡¨å: `livescore`

- ä¸»é”®: `id` (è‡ªå¢)
- ç´¢å¼•: 
  - `idx_sport_date` (sport, date)
  - `idx_language` (language)
  - `idx_league` (league)
  - `idx_status` (status)
  - `idx_teams` (team1, team2)
  - `idx_created_at` (created_at)

## æ¯”èµ›çŠ¶æ€è¯´æ˜

### æœªå¼€å§‹çŠ¶æ€
- `scheduled` - å·²å®‰æ’ä½†å°šæœªå¼€å§‹
- `not_started` - æœªå¼€å§‹
- `upcoming` - å³å°†å¼€å§‹
- `postponed` - æ¨è¿Ÿ
- `cancelled` - å–æ¶ˆ
- `delayed` - å»¶è¿Ÿ

### è¿›è¡Œä¸­çŠ¶æ€
- `live` - è¿›è¡Œä¸­
- `in_progress` - è¿›è¡Œä¸­
- `first_half` - ä¸ŠåŠåœº
- `second_half` - ä¸‹åŠåœº
- `halftime` - ä¸­åœºä¼‘æ¯
- `overtime` - åŠ æ—¶èµ›
- `penalty` - ç‚¹çƒå¤§æˆ˜
- `break` - ä¼‘æ¯

### å·²ç»“æŸçŠ¶æ€
- `finished` - å·²ç»“æŸ
- `full_time` - å…¨åœºç»“æŸ
- `completed` - å·²å®Œæˆ
- `final` - æœ€ç»ˆ
- `ended` - å·²ç»“æŸ

### ç‰¹æ®ŠçŠ¶æ€
- `suspended` - æš‚åœ
- `interrupted` - ä¸­æ–­
- `abandoned` - æ”¾å¼ƒ
- `walkover` - å¼ƒæƒ
- `awarded` - åˆ¤å†³
- `unknown` - æœªçŸ¥

## æ•°æ®ç®¡é“

ç³»ç»ŸåŒ…å«ä¸‰ä¸ªæ•°æ®å¤„ç†ç®¡é“:

1. **LivescoreValidationPipeline** (ä¼˜å…ˆçº§: 200)
   - éªŒè¯å¿…å¡«å­—æ®µ
   - æ£€æŸ¥æ•°æ®ç±»å‹
   - é™åˆ¶å­—æ®µé•¿åº¦

2. **LivescoreCleaningPipeline** (ä¼˜å…ˆçº§: 300)
   - æ¸…ç†å­—ç¬¦ä¸²å­—æ®µ
   - æ ‡å‡†åŒ–æ•°æ®æ ¼å¼
   - å»é™¤å¤šä½™ç©ºæ ¼

3. **LivescoreDatabasePipeline** (ä¼˜å…ˆçº§: 400)
   - æ‰¹é‡æ’å…¥æ•°æ®åº“
   - é”™è¯¯å¤„ç†å’Œé‡è¯•
   - æ€§èƒ½ä¼˜åŒ–

## æ€§èƒ½ä¼˜åŒ–

### æ‰¹é‡å¤„ç†
- é»˜è®¤æ‰¹å¤„ç†å¤§å°: 100æ¡è®°å½•
- æ”¯æŒè‡ªå®šä¹‰æ‰¹å¤„ç†å¤§å°
- å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°å•æ¡æ’å…¥

### æ•°æ®åº“è¿æ¥
- è¿æ¥æ± ç®¡ç†
- è‡ªåŠ¨é‡è¿æœºåˆ¶
- è¿æ¥è¶…æ—¶å¤„ç†

### å†…å­˜ç®¡ç†
- å†…å­˜ä½¿ç”¨é™åˆ¶: 2GB
- è‡ªåŠ¨åƒåœ¾å›æ”¶
- ç¼“å†²åŒºç®¡ç†

## ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—çº§åˆ«
- DEBUG: è¯¦ç»†è°ƒè¯•ä¿¡æ¯
- INFO: ä¸€èˆ¬ä¿¡æ¯ (é»˜è®¤)
- WARNING: è­¦å‘Šä¿¡æ¯
- ERROR: é”™è¯¯ä¿¡æ¯

### ç»Ÿè®¡ä¿¡æ¯
- æ€»è®°å½•æ•°
- æŒ‰è¿åŠ¨ç±»å‹ç»Ÿè®¡
- æŒ‰è¯­è¨€ç»Ÿè®¡
- æŒ‰çŠ¶æ€ç»Ÿè®¡
- å¤„ç†é€Ÿåº¦ç»Ÿè®¡

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“URLæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤æ•°æ®åº“æœåŠ¡æ˜¯å¦è¿è¡Œ
   - éªŒè¯ç”¨æˆ·åå’Œå¯†ç 

2. **JSONæ–‡ä»¶è¯»å–å¤±è´¥**
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨
   - ç¡®è®¤æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
   - éªŒè¯æ–‡ä»¶ç¼–ç  (å»ºè®®UTF-8)

3. **å†…å­˜ä¸è¶³**
   - å‡å°‘æ‰¹å¤„ç†å¤§å°
   - å¢åŠ ç³»ç»Ÿå†…å­˜
   - åˆ†æ‰¹å¤„ç†å¤§æ–‡ä»¶

4. **æ’å…¥é€Ÿåº¦æ…¢**
   - å¢åŠ æ‰¹å¤„ç†å¤§å°
   - æ£€æŸ¥æ•°æ®åº“ç´¢å¼•
   - ä¼˜åŒ–ç½‘ç»œè¿æ¥

### è°ƒè¯•æ¨¡å¼

```bash
python run_spider.py --log-level DEBUG
```

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æ•°æ®æº

1. åœ¨ `spiders/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„çˆ¬è™«æ–‡ä»¶
2. ç»§æ‰¿ `scrapy.Spider` ç±»
3. å®ç° `start_requests()` å’Œ `parse()` æ–¹æ³•
4. è¿”å› `LivescoreItem` å¯¹è±¡

### æ·»åŠ æ–°çš„æ•°æ®ç®¡é“

1. åœ¨ `pipelines/__init__.py` ä¸­æ·»åŠ æ–°çš„ç®¡é“ç±»
2. å®ç° `process_item()` æ–¹æ³•
3. åœ¨ `settings/__init__.py` ä¸­æ³¨å†Œç®¡é“

### è‡ªå®šä¹‰æ•°æ®å­—æ®µ

1. åœ¨ `items/__init__.py` ä¸­ä¿®æ”¹ `LivescoreItem`
2. æ›´æ–°æ•°æ®åº“æ¨¡å‹ `LivescoreMatch`
3. ä¿®æ”¹ç›¸å…³çš„æ•°æ®å¤„ç†é€»è¾‘

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»:

- åˆ›å»º GitHub Issue
- å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…

---

**æ³¨æ„**: è¯·ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰è¿›è¡Œå……åˆ†æµ‹è¯•ï¼Œå¹¶æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´é…ç½®å‚æ•°ã€‚